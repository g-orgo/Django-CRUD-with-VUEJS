<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Garagem do gordão</title>

        <!-- Vue and bootstrap-vue js files -->
        <script src="//unpkg.com/vue@latest/dist/vue.min.js"></script>
        <script src="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>

        <!-- Bootstrap css files -->
        <link
            type="text/css"
            rel="stylesheet"
            href="//unpkg.com/bootstrap/dist/css/bootstrap.min.css"
        />
        <link
            type="text/css"
            rel="stylesheet"
            href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css"
        />

        <!-- Axios -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
            integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
            crossorigin="anonymous"
        ></script>

        <!-- Javascript Cookie lib -->
        <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
    </head>

    <body>
        <b-container id="app">
            <b-row>
                <b-btn v-on:click="createGarageSpot()">
                    Ocupar vaga de forma anônima</b-btn
                >
            </b-row>
            <b-row> [{ garages_spots }] </b-row>
        </b-container>
    </body>

    <script>
        const csrftoken = Cookies.get("csrftoken");

        let app = new Vue({
            el: "#app",
            delimiters: ["[{", "}]"],
            data: {
                garages_spots: [],
                blank_garage: {
                    garage_name: "anonymous",
                },
            },
            methods: {
                getGaragesSpots: function () {
                    axios
                        .get("api/garages/")
                        .then((res) => {
                            this.garages_spots = res.data;
                        })
                        .catch((err) => {
                            console.log(err);
                        });
                },
                createGarageSpot: function () {
                    axios
                        .post("api/garages/", this.blank_garage, {
                            headers: { "X-CSRFTOKEN": csrftoken },
                        })
                        .then((res) => {
                            this.getGaragesSpots()
                            /* console.log(res); */
                        });
                },
            },
            mounted: function () {
                this.getGaragesSpots();
            },
        });
    </script>
</html>
